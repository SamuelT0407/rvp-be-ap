# 在已有业务上添加新功能

## 概述

在已经存在的业务模块上添加新功能，遵循 **API 先行** 原则。

---

## 标准流程

### Step 1: 分析需求

- 明确新功能涉及的**数据字段**
- 确认后端接口是否已就绪
- 确认功能属于哪个业务模块

### Step 2: 修改/新增 API

#### 位置

`src/api/{module}/`

#### 操作

1. **检查 `types.ts`**: 是否需要新增字段到 `Query`、`VO`、`Form`
2. **检查 `index.ts`**: 是否需要新增 API 函数

#### ⚠️ 重要检查

```
在修改 API 之前，必须检查该 API 是否被其他页面使用！
```

- 使用全局搜索 (Ctrl+Shift+F) 搜索 API 函数名
- 如果有多处调用，评估修改是否会影响其他功能
- 必要时新增一个独立的 API 函数而非修改已有函数

### Step 3: 修改 Vue 页面

#### 位置

`src/views/{module}/`

#### 操作

1. **Template**: 添加 UI 元素 (表单项、表格列、按钮等)
2. **Script**: 添加状态变量、处理函数
3. **验证规则**: 如有新的表单字段，添加 `rules`

### Step 4: 代码复用检查

#### 组件抽取 (Components)

```
如果发现相同的 Template 结构出现 ≥2 次，必须抽取为独立组件
```

- 放置位置: `src/components/` 或页面同级目录
- 命名: PascalCase (如 `StatusSwitch.vue`)

#### 工具函数抽取 (Utils)

```
如果发现相同的逻辑处理出现 ≥2 次，必须抽取为工具函数
```

- 放置位置: `src/utils/`
- 命名: camelCase (如 `formatDateTime.ts`)

---

## Checklist

在完成功能开发后，确认以下事项：

- [ ] API 类型定义已更新
- [ ] API 函数已添加/修改
- [ ] 检查了 API 的复用情况
- [ ] Vue 页面已更新
- [ ] 表单验证规则已添加
- [ ] 重复代码已抽取为组件/工具函数
- [ ] 页面功能正常运行
